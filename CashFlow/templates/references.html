{% extends 'base.html' %}

{% block title %}Справочники - CashFlow Manager{% endblock %}

{% block content %}
<!-- Header -->
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h1 class="h2 text-primary">
            <i class="bi bi-book me-2"></i>Управление справочниками
        </h1>
        <p class="text-muted">Настройка статусов, типов операций, категорий и подкатегорий</p>
    </div>
</div>

<!-- Tabs Navigation -->
<ul class="nav nav-tabs mb-4" id="referencesTabs" role="tablist">
    <li class="nav-item" role="presentation">
        <button class="nav-link active" id="status-tab" data-bs-toggle="tab" data-bs-target="#status" type="button">
            <i class="bi bi-tag me-1"></i>Статусы
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="types-tab" data-bs-toggle="tab" data-bs-target="#types" type="button">
            <i class="bi bi-arrow-left-right me-1"></i>Типы операций
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="categories-tab" data-bs-toggle="tab" data-bs-target="#categories" type="button">
            <i class="bi bi-folder me-1"></i>Категории
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="subcategories-tab" data-bs-toggle="tab" data-bs-target="#subcategories" type="button">
            <i class="bi bi-folder2 me-1"></i>Подкатегории
        </button>
    </li>
</ul>

<!-- Tabs Content -->
<div class="tab-content" id="referencesTabsContent">
    <!-- Statuses Tab -->
    <div class="tab-pane fade show active" id="status" role="tabpanel">
        <div class="card shadow-sm">
            <div class="card-header bg-white d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0">
                    <i class="bi bi-tag me-2"></i>Статусы операций
                </h5>
                <button class="btn btn-sm btn-primary" onclick="showAddModal('/api/statuses/', 'name,description')">
                    <i class="bi bi-plus-circle me-1"></i>Добавить
                </button>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead class="table-light">
                            <tr>
                                <th>Название</th>
                                <th>Описание</th>
                                <th class="text-center" style="width: 100px;">Действия</th>
                            </tr>
                        </thead>
                        <tbody id="statuses-table">
                            <tr>
                                <td colspan="3" class="text-center py-4">
                                    <div class="text-muted">
                                        <i class="bi bi-database fs-1 d-block mb-2"></i>
                                        Загрузка данных...
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Types Tab -->
    <div class="tab-pane fade" id="types" role="tabpanel">
        <div class="card shadow-sm">
            <div class="card-header bg-white d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0">
                    <i class="bi bi-arrow-left-right me-2"></i>Типы операций
                </h5>
                <button class="btn btn-sm btn-primary" onclick="showAddModal('/api/transaction-types/', 'name,description')">
                    <i class="bi bi-plus-circle me-1"></i>Добавить
                </button>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead class="table-light">
                            <tr>
                                <th>Название</th>
                                <th>Описание</th>
                                <th class="text-center" style="width: 100px;">Действия</th>
                            </tr>
                        </thead>
                        <tbody id="transaction-types-table">
                            <tr>
                                <td colspan="3" class="text-center py-4">
                                    <div class="text-muted">
                                        <i class="bi bi-database fs-1 d-block mb-2"></i>
                                        Загрузка данных...
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Categories Tab -->
    <div class="tab-pane fade" id="categories" role="tabpanel">
        <div class="card shadow-sm">
            <div class="card-header bg-white d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0">
                    <i class="bi bi-folder me-2"></i>Категории
                </h5>
                <button class="btn btn-sm btn-primary" onclick="showAddModal('/api/categories/', 'name,transaction_type,description')">
                    <i class="bi bi-plus-circle me-1"></i>Добавить
                </button>
            </div>
            <div class="card-body">
                <div class="row mb-3">
                    <div class="col-md-8">
                        <div class="input-group">
                            <span class="input-group-text">
                                <i class="bi bi-search"></i>
                            </span>
                            <input type="text" class="form-control" placeholder="Поиск..." 
                                   oninput="filterReferences('/api/categories/', this.value)">
                        </div>
                    </div>
                    <div class="col-md-4">
                        <select class="form-select" id="categories-type-filter"
                                onchange="filterByRelation('/api/categories/', this.value, 'transaction_type')">
                            <option value="">Все типы операций</option>
                        </select>
                    </div>
                </div>
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead class="table-light">
                            <tr>
                                <th>Название</th>
                                <th>Тип операции</th>
                                <th>Описание</th>
                                <th class="text-center" style="width: 100px;">Действия</th>
                            </tr>
                        </thead>
                        <tbody id="categories-table">
                            <tr>
                                <td colspan="4" class="text-center py-4">
                                    <div class="text-muted">
                                        <i class="bi bi-database fs-1 d-block mb-2"></i>
                                        Загрузка данных...
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div class="tab-pane fade" id="subcategories" role="tabpanel">
        <div class="card shadow-sm">
            <div class="card-header bg-white d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0">
                    <i class="bi bi-folder2 me-2"></i>Подкатегории
                </h5>
                <button class="btn btn-sm btn-primary" onclick="showAddModal('/api/subcategories/', 'name,category,description')">
                    <i class="bi bi-plus-circle me-1"></i>Добавить
                </button>
            </div>
            <div class="card-body">
                <div class="row mb-3">
                    <div class="col-md-8">
                        <div class="input-group">
                            <span class="input-group-text">
                                <i class="bi bi-search"></i>
                            </span>
                            <input type="text" class="form-control" placeholder="Поиск..." 
                                   oninput="filterReferences('/api/subcategories/', this.value)">
                        </div>
                    </div>
                    <div class="col-md-4">
                        <select class="form-select" id="subcategories-category-filter"
                                onchange="filterByRelation('/api/subcategories/', this.value, 'category')">
                            <option value="">Все категории</option>
                        </select>
                    </div>
                </div>
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead class="table-light">
                            <tr>
                                <th>Название</th>
                                <th>Категория</th>
                                <th>Описание</th>
                                <th class="text-center" style="width: 100px;">Действия</th>
                            </tr>
                        </thead>
                        <tbody id="subcategories-table">
                            <tr>
                                <td colspan="4" class="text-center py-4">
                                    <div class="text-muted">
                                        <i class="bi bi-database fs-1 d-block mb-2"></i>
                                        Загрузка данных...
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

{% include 'partials/_reference_modals.html' %}
{% endblock %}

{% block scripts %}
<script src="/static/js/references.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        initializeReferences();
    });
</script>
{% endblock %}